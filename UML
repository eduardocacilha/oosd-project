@startuml
' Título do Diagrama
title Diagrama de Classes Completo - Sistema de Festas MVC

' Parâmetros para um visual limpo e profissional
skinparam shadowing false
skinparam packageStyle rectangle
skinparam classAttributeIconSize 0
skinparam defaultFontName Segoe UI
skinparam roundCorner 10

' =============== CAMADA DE VIEWS ===============
package "Views" {
    class MainView {
        + __init__()
        + mostrar_menu_principal()
    }
    class UsuarioView {
        + __init__()
        + tela_opcoes()
        + pega_dados_usuario()
    }
    class EventoView {
        + __init__()
        + tela_opcoes()
        + pega_dados_evento()
    }
    class IngressoView {
        + __init__()
        + tela_opcoes()
        + seleciona_ingresso()
    }
    class ProdutoView {
        + __init__()
        + tela_opcoes()
        + pega_tipo_produto()
        + pega_dados_produto()
    }
    class RelatorioView {
        + __init__()
        + tela_opcoes()
        + exibir_relatorio_vendas(relatorio)
    }
}

' =============== CAMADA DE CONTROLLERS ===============
package "Controllers" {
    class MainController {
        + usuario_controller: UsuarioController
        + evento_controller: EventoController
        + produto_controller: ProdutoController
        + relatorio_controller: RelatorioController
        + __init__()
        + iniciar()
    }
    class UsuarioController {
        - __usuarios: List<Usuario>
        + __init__()
        + incluir_usuario(dados)
        + buscar_usuario_por_matricula(matricula)
    }
    class EventoController {
        - __eventos: List<Evento>
        + __init__()
        + adicionar_evento(dados)
        + listar_eventos()
    }
    class IngressoController {
        + __init__()
        + comprar_ingresso(usuario, evento)
        + colocar_ingresso_a_venda(usuario, ingresso)
    }
    class ProdutoController {
        + __init__()
        + adicionar_produto_a_evento(evento)
        + registrar_venda(evento, carrinho)
    }
    class RelatorioController {
        + __init__()
        + gerar_relatorio_vendas(evento)
    }
}


' =============== CAMADA DE MODELS ===============
package "Models" {
    ' --- Entidades Principais ---
    class Usuario {
        - matricula: str
        - nome: str
        + __init__(matricula, nome, email)
        + comprar_ingresso(evento)
    }
    class Evento {
        - nome: str
        - data: str
        - produtos: List<Produto>
        - vendas: List<Venda>
        + __init__(nome, data, local)
        + adicionar_produto(produto)
    }
    class Ingresso {
        + evento: Evento
        + comprador: Usuario
        + __init__(evento, comprador, data)
    }
    class Venda {
        - data_hora: DateTime
        - itens: List<ItemVenda>
        + __init__(usuario: 'Usuario', evento: 'Evento', metodo_pagamento: str)
        + adicionar_item(produto, qtd)
    }
    class ItemVenda {
        - produto: Produto
        - quantidade: int
        + __init__(produto, qtd)
    }
    class Feedback {
        - nota: int
        - comentario: str
        + __init__(usuario, evento, nota)
    }

    ' --- Hierarquia de Produto ---
    abstract class Produto {
        - id_produto: int
        - nome: str
        - preco: float
        + __init__(id, nome, preco, estoque)
        + {abstract} descricao()
    }
    class Camisa extends Produto {
        - tamanho: str
        - cor: str
        + __init__(id_produto: int, nome: str, preco: float, estoque: int = 0, tamanho: str = "M", cor: str = "branca")
        + descricao()
    }
    class Copo extends Produto {
        - capacidade_ml: int
        + __init__(id_produto: int, nome: str, preco: float, estoque: int, capacidade_ml: int, material: str)
        + descricao()
    }
    
    ' ========== RELACIONAMENTOS DO MODEL (Corrigidos) ==========


    ' --- 2. Composição ---
    ' (Uma Venda CONTÉM 1 ou mais ItensVenda)
    Venda "1" *-- "1..*" ItemVenda : contém >
    
    ' --- 3. Agregação ---
    ' (Um Evento OFERECE 0 ou mais Produtos)
    Evento "1" o-- "0..*" Produto : oferece >
    
    ' --- 4. Associações (O que faltava) ---
    
    ' Usuário <-> Venda
    ' (Um Usuário FAZ 0 ou mais Vendas)
    Usuario "1" --> "0..*" Venda : faz >
    
    ' Usuário <-> Feedback
    ' (Um Usuário ESCREVE 0 ou mais Feedbacks)
    Usuario "1" --> "0..*" Feedback : escreve >
    
    ' Evento <-> Feedback
    ' (Um Evento RECEBE 0 ou mais Feedbacks)
    Evento "1" --> "0..*" Feedback : < recebe
    
    ' Evento <-> Ingresso
    ' (Um Evento EMITE 0 ou mais Ingressos)
    Evento "1" --> "0..*" Ingresso : emite >
    
    ' Ingresso <-> Usuario (Comprador)
    ' (Um Ingresso tem 1 Comprador)
    Ingresso "1" --> "1" Usuario : comprador
    
    ' Ingresso <-> Usuario (Revendedor)
    ' (Um Ingresso tem 0 ou 1 Revendedor)
    Ingresso "1" --> "0..1" Usuario : revendedor
    
    ' ItemVenda <-> Produto
    ' (Um ItemVenda REFERE-SE A 1 Produto)
    ItemVenda "1" --> "1" Produto : refere-se a
}

' ========== RELACIONAMENTOS DO PADRÃO MVC ==========

' --- A View depende do seu Controller ---
MainView ..> MainController
UsuarioView ..> UsuarioController
EventoView ..> EventoController
IngressoView ..> IngressoController
ProdutoView ..> ProdutoController
RelatorioView ..> RelatorioController

' --- O Controller depende do seu Model ---
UsuarioController ..> Usuario
EventoController ..> Evento
IngressoController ..> Ingresso
ProdutoController ..> Produto
ProdutoController ..> Venda
RelatorioController ..> Venda
RelatorioController ..> Ingresso
RelatorioController ..> Evento
Usuario --> Venda
Evento --> Ingresso
Produto --> ItemVenda

' --- Controllers conversam entre si (Injeção de Dependência) ---
MainController ..> UsuarioController
MainController ..> EventoController
MainController ..> IngressoController
MainController ..> ProdutoController
MainController ..> RelatorioController
IngressoController ..> UsuarioController
IngressoController ..> EventoController
ProdutoController ..> UsuarioController
ProdutoController ..> EventoController
RelatorioController ..> UsuarioController
RelatorioController ..> EventoController
RelatorioController ..> ProdutoController

@enduml